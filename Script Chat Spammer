-- Aimlock Script para Roblox
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local mouse = player:GetMouse()
local camera = workspace.CurrentCamera

-- Variáveis do Aimlock
local aimlockEnabled = false
local currentTarget = nil
local connection = nil

-- Configurações
local maxDistance = 500 -- Distância máxima para detectar alvos
local smoothness = 0.2 -- Suavidade do aimlock (0-1, menor = mais suave)

-- Função para encontrar o jogador mais próximo
local function getClosestPlayer()
    local closestPlayer = nil
    local shortestDistance = maxDistance
    
    for _, otherPlayer in pairs(Players:GetPlayers()) do
        if otherPlayer ~= player and otherPlayer.Character and otherPlayer.Character:FindFirstChild("Head") then
            local character = otherPlayer.Character
            local head = character.Head
            
            -- Verifica se o jogador está vivo
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid and humanoid.Health > 0 then
                local distance = (head.Position - camera.CFrame.Position).Magnitude
                
                if distance < shortestDistance then
                    closestPlayer = otherPlayer
                    shortestDistance = distance
                end
            end
        end
    end
    
    return closestPlayer
end

-- Função para verificar se o alvo atual ainda é válido
local function isTargetValid(target)
    if not target or not target.Character or not target.Character:FindFirstChild("Head") then
        return false
    end
    
    local humanoid = target.Character:FindFirstChild("Humanoid")
    if not humanoid or humanoid.Health <= 0 then
        return false
    end
    
    local distance = (target.Character.Head.Position - camera.CFrame.Position).Magnitude
    return distance <= maxDistance
end

-- Função principal do aimlock
local function aimlock()
    if not aimlockEnabled then
        return
    end
    
    -- Verifica se o alvo atual ainda é válido
    if currentTarget and not isTargetValid(currentTarget) then
        currentTarget = nil
    end
    
    -- Se não há alvo, procura um novo
    if not currentTarget then
        currentTarget = getClosestPlayer()
    end
    
    -- Se encontrou um alvo, mira nele
    if currentTarget and currentTarget.Character and currentTarget.Character:FindFirstChild("Head") then
        local head = currentTarget.Character.Head
        local targetPosition = head.Position
        
        -- Calcula a direção para o alvo
        local direction = (targetPosition - camera.CFrame.Position).Unit
        local newCFrame = CFrame.lookAt(camera.CFrame.Position, targetPosition)
        
        -- Aplica suavidade ao movimento
        camera.CFrame = camera.CFrame:Lerp(newCFrame, smoothness)
    end
end

-- Função para toggle do aimlock
local function toggleAimlock()
    aimlockEnabled = not aimlockEnabled
    
    if aimlockEnabled then
        print("Aimlock Ativado")
        currentTarget = nil
        connection = RunService.RenderStepped:Connect(aimlock)
    else
        print("Aimlock Desativado")
        currentTarget = nil
        if connection then
            connection:Disconnect()
            connection = nil
        end
    end
    
    -- Atualiza a GUI
    if toggleButton then
        toggleButton.Text = aimlockEnabled and "Aim Lock: ON" or "Aim Lock: OFF"
        toggleButton.BackgroundColor3 = aimlockEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
    end
end

-- Criação da GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AimlockGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Frame principal
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 200, 0, 100)
mainFrame.Position = UDim2.new(0, 10, 0, 10)
mainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
mainFrame.BorderSizePixel = 2
mainFrame.BorderColor3 = Color3.fromRGB(0, 162, 255)
mainFrame.Parent = screenGui

-- Arredondar cantos
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainFrame

-- Título
local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "Title"
titleLabel.Size = UDim2.new(1, 0, 0, 30)
titleLabel.Position = UDim2.new(0, 0, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Aimlock"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextScaled = true
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.Parent = mainFrame

-- Botão Toggle
toggleButton = Instance.new("TextButton")
toggleButton.Name = "ToggleButton"
toggleButton.Size = UDim2.new(0.9, 0, 0, 40)
toggleButton.Position = UDim2.new(0.05, 0, 0.5, 0)
toggleButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
toggleButton.Text = "Aim Lock: OFF"
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.TextScaled = true
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.Parent = mainFrame

-- Arredondar cantos do botão
local buttonCorner = Instance.new("UICorner")
buttonCorner.CornerRadius = UDim.new(0, 6)
buttonCorner.Parent = toggleButton

-- Efeito de hover no botão
local buttonHover = false
toggleButton.MouseEnter:Connect(function()
    buttonHover = true
    local tween = TweenService:Create(
        toggleButton,
        TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {Size = UDim2.new(0.95, 0, 0, 42)}
    )
    tween:Play()
end)

toggleButton.MouseLeave:Connect(function()
    buttonHover = false
    local tween = TweenService:Create(
        toggleButton,
        TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {Size = UDim2.new(0.9, 0, 0, 40)}
    )
    tween:Play()
end)

-- Conectar evento de clique
toggleButton.MouseButton1Click:Connect(toggleAimlock)

-- Funcionalidade de arrastar a GUI
local dragging = false
local dragStart = nil
local startPos = nil

mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
    end
end)

mainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

mainFrame.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

-- Cleanup quando o jogador sair
Players.PlayerRemoving:Connect(function(leavingPlayer)
    if currentTarget == leavingPlayer then
        currentTarget = nil
    end
end)

print("Aimlock GUI carregada! Clique no botão para ativar/desativar.")l = 2
    textBox.Text = "Digite sua mensagem aqui..."
    textBox.TextColor3 = Color3.new(1, 1, 1)
    textBox.TextScaled = true
    textBox.Font = Enum.Font.SourceSans
    textBox.ClearTextOnFocus = true
    textBox.Parent = mainFrame

    -- Botão INICIAR SPAM
    local spamButton = Instance.new("TextButton")
    spamButton.Name = "SpamButton"
    spamButton.Size = UDim2.new(0.42, 0, 0, 40)
    spamButton.Position = UDim2.new(0.05, 0, 0, 160)
    spamButton.BackgroundColor3 = Color3.new(0.2, 0.8, 0.2)
    spamButton.BorderSizePixel = 0
    spamButton.Text = "▶️ INICIAR SPAM"
    spamButton.TextColor3 = Color3.new(1, 1, 1)
    spamButton.TextScaled = true
    spamButton.Font = Enum.Font.SourceSansBold
    spamButton.Parent = mainFrame

    -- Botão PARAR SPAM
    local stopButton = Instance.new("TextButton")
    stopButton.Name = "StopButton"
    stopButton.Size = UDim2.new(0.42, 0, 0, 40)
    stopButton.Position = UDim2.new(0.53, 0, 0, 160)
    stopButton.BackgroundColor3 = Color3.new(0.8, 0.2, 0.2)
    stopButton.BorderSizePixel = 0
    stopButton.Text = "⏹️ PARAR SPAM"
    stopButton.TextColor3 = Color3.new(1, 1, 1)
    stopButton.TextScaled = true
    stopButton.Font = Enum.Font.SourceSansBold
    stopButton.Visible = false
    stopButton.Parent = mainFrame

    -- ===== FUNÇÕES DO CHAT SPAMMER (QUE FUNCIONAVA) =====
    
    -- Função para enviar mensagem no chat (FUNCIONAL)
    local function sendMessage(message)
        spawn(function()
            -- Método 1: ReplicatedStorage (mais comum)
            pcall(function()
                game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(message, "All")
            end)
            
            -- Método 2: Chat Service
            pcall(function()
                if player.Character and player.Character:FindFirstChild("Head") then
                    game:GetService("Chat"):Chat(player.Character.Head, message)
                end
            end)
            
            -- Método 3: TextChatService (jogos novos)
            pcall(function()
                local textChatService = game:GetService("TextChatService")
                local generalChannel = textChatService.TextChannels:FindFirstChild("RBXGeneral")
                if generalChannel then
                    generalChannel:SendAsync(message)
                end
            end)
        end)
    end

    -- Função para iniciar spam
    local function startSpam()
        local message = textBox.Text
        if message == "" or message == "Digite sua mensagem aqui..." then
            -- Feedback visual de erro
            textBox.BorderColor3 = Color3.new(1, 0.3, 0.3)
            wait(1)
            textBox.BorderColor3 = Color3.new(0.3, 0.7, 1)
            return
        end
        
        spamming = true
        spamButton.Visible = false
        stopButton.Visible = true
        textBox.TextEditable = false
        textBox.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
        
        print("🚀 SPAM INICIADO: " .. message)
        
        -- Loop de spam usando spawn (VOLTA AO QUE FUNCIONAVA)
        spawn(function()
            while spamming do
                sendMessage(message)
                wait(0.1) -- 100 milissegundos
            end
        end)
    end

    -- Função para parar spam
    local function stopSpam()
        spamming = false
        
        spamButton.Visible = true
        stopButton.Visible = false
        textBox.TextEditable = true
        textBox.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
        
        print("⏹️ SPAM PARADO")
    end

    -- ===== EVENTOS DOS BOTÕES =====
    spamButton.MouseButton1Click:Connect(startSpam)
    stopButton.MouseButton1Click:Connect(stopSpam)
    
    closeButton.MouseButton1Click:Connect(function()
        stopSpam()
        screenGui:Destroy()
        print("❌ Chat Spammer fechado")
    end)

    -- ===== EVENTOS DA CAIXA DE TEXTO =====
    textBox.Focused:Connect(function()
        if textBox.Text == "Digite sua mensagem aqui..." then
            textBox.Text = ""
        end
        textBox.BorderColor3 = Color3.new(0, 1, 0.5)
    end)

    textBox.FocusLost:Connect(function(enterPressed)
        if textBox.Text == "" then
            textBox.Text = "Digite sua mensagem aqui..."
        end
        textBox.BorderColor3 = Color3.new(0.3, 0.7, 1)
        
        -- Permitir Enter para iniciar spam
        if enterPressed and not spamming and textBox.Text ~= "Digite sua mensagem aqui..." then
            startSpam()
        end
    end)
end

-- ===== INICIAR O SISTEMA COM DELAY =====
print("🔄 Executando Chat Spammer...")
showSplash()
